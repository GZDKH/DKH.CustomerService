syntax = "proto3";

package customer.api.v1;

option csharp_namespace = "DKH.CustomerService.Contracts.Api.V1";

import "google/protobuf/timestamp.proto";
import "customer/models/v1/customer_profile.proto";
import "customer/models/v1/account_status.proto";
import "types/guid.proto";
import "types/pagination.proto";
import "types/pagination_metadata.proto";

service CustomerAdminService {
  rpc SearchCustomers(SearchCustomersRequest) returns (SearchCustomersResponse);
  rpc ListCustomers(ListCustomersRequest) returns (ListCustomersResponse);
  rpc GetCustomerStats(GetCustomerStatsRequest) returns (GetCustomerStatsResponse);
  rpc BlockCustomer(BlockCustomerRequest) returns (BlockCustomerResponse);
  rpc UnblockCustomer(UnblockCustomerRequest) returns (UnblockCustomerResponse);
  rpc SuspendCustomer(SuspendCustomerRequest) returns (SuspendCustomerResponse);
  rpc ExportCustomerData(ExportCustomerDataRequest) returns (ExportCustomerDataResponse);
  rpc DeleteCustomerData(DeleteCustomerDataRequest) returns (DeleteCustomerDataResponse);
}

message SearchCustomersRequest {
  optional proto.platform.grpc.common.types.GuidValue storefront_id = 1;  // Optional for admin (returns all), required for storefront
  string query = 2;
  proto.platform.grpc.common.types.PaginationRequest pagination = 3;
}

message SearchCustomersResponse {
  repeated customer.models.v1.CustomerProfile customers = 1;
  proto.platform.grpc.common.types.PaginationMetadata pagination = 2;
}

message ListCustomersRequest {
  optional proto.platform.grpc.common.types.GuidValue storefront_id = 1;  // Optional for admin (returns all), required for storefront
  proto.platform.grpc.common.types.PaginationRequest pagination = 2;
  string sort_by = 3;
  bool sort_descending = 4;
  customer.models.v1.AccountStatusEnum status_filter = 5;
}

message ListCustomersResponse {
  repeated customer.models.v1.CustomerProfile customers = 1;
  proto.platform.grpc.common.types.PaginationMetadata pagination = 2;
}

message GetCustomerStatsRequest {
  proto.platform.grpc.common.types.GuidValue storefront_id = 1;
  string telegram_user_id = 2;
}

message GetCustomerStatsResponse {
  customer.models.v1.CustomerStats stats = 1;
}

message BlockCustomerRequest {
  proto.platform.grpc.common.types.GuidValue storefront_id = 1;
  string telegram_user_id = 2;
  string reason = 3;
  string blocked_by = 4;
}

message BlockCustomerResponse {
  bool success = 1;
  customer.models.v1.CustomerProfile profile = 2;
}

message UnblockCustomerRequest {
  proto.platform.grpc.common.types.GuidValue storefront_id = 1;
  string telegram_user_id = 2;
}

message UnblockCustomerResponse {
  bool success = 1;
  customer.models.v1.CustomerProfile profile = 2;
}

message SuspendCustomerRequest {
  proto.platform.grpc.common.types.GuidValue storefront_id = 1;
  string telegram_user_id = 2;
  google.protobuf.Timestamp suspend_until = 3;
  string reason = 4;
  string suspended_by = 5;
}

message SuspendCustomerResponse {
  bool success = 1;
  customer.models.v1.CustomerProfile profile = 2;
}

message ExportCustomerDataRequest {
  proto.platform.grpc.common.types.GuidValue storefront_id = 1;
  string telegram_user_id = 2;
  string format = 3;
}

message ExportCustomerDataResponse {
  bytes data = 1;
  string content_type = 2;
  string file_name = 3;
}

message DeleteCustomerDataRequest {
  proto.platform.grpc.common.types.GuidValue storefront_id = 1;
  string telegram_user_id = 2;
  bool anonymize = 3;
}

message DeleteCustomerDataResponse {
  bool success = 1;
  string anonymized_id = 2;
}
